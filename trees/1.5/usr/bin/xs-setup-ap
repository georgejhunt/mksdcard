#!/bin/bash -x
# script that runs at boot via systemd to set HWADDR in ifcfg-wlan0

# if access-point desired, and any ifcfg has our hw_addr, delete it
if [ -f /etc/xsce/access-point ]; then 
hardware_address=`cat /sys/class/net/wlan0/address`
egrep -irn $hardware_address /etc/sysconfig/network-scripts/ifcfg-* | \
          gawk -F":" '{print $1}' | xargs rm -f
cat <<EOF > /etc/sysconfig/network-scripts/ifcfg-wlan0
# Generated by XSCE
TYPE=Ethernet
BOOTPROTO=none
BRIDGE=br0
ONBOOT=yes
NM_CONTROLLED=no

# needs work but it's a start
HWADDR=$hardware_address
DEVICE=wlan0
EOF
fi
